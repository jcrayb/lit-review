<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulation Management</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script src="https://cdn.plot.ly/plotly-3.0.0.min.js" charset="utf-8"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>


    <style>
        :root{
            --card-width: 250px;
            --card-height: 300px;
        }

        nav{
            padding-top: 1rem;
            padding-left: 1rem;
            border-bottom: 1px solid black;
            padding-bottom: 1rem;
            background-color: #fff;
        }

        .card-grid{
            width: 100%;
            display: grid;
            grid-template-columns: repeat(auto-fit, var(--card-width));
            grid-auto-rows: 1fr;
            gap: 10px;
        }

        .sim-card{
            background-color: #fff;
            height: var(--card-height);
            border: 1px solid #ccc;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
        }

        .stat-card{
            background-color: #fff;
            border: 1px solid #ccc;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
        }

        .new-card{
            height: var(--card-height);
            background-color: #fff;
            border: 4px solid #ccc;
            border-style: dashed;
        }

        .add-new-card{
            display: flex;
            justify-content: center;
            align-items: center;
        }

        section{
            margin-bottom: 1.5rem;
        }

        body{
            background-color: #eee;
        }

        .alert-container{
            position: fixed;
            left: 0;
            top: 0px;
            z-index: 10000;
        }

        .alert-container p{
            margin: 0;
            transition: all 1s cubic-bezier(0,.8,0,.8);
            transition: all 1s cubic-bezier(0,.8,0,.8) allow-discrete;
            opacity: 0;
            scale: 0;
            display: none;
            z-index: 10000;
        }

        .show-alert p{
            display: block !important;
            opacity: 1 !important;
            scale: 1 !important;
            transition: all 0s;
        }

        .empty-alert{
            border-color: var(--bs-danger);
        }
    </style>

    <script>
        function generateRandomHex() {
            let randomNumber = Math.floor(Math.random() * 16777215); 

            return "" + randomNumber.toString(16).padStart(6, '0'); 
        }

        function popup(){
            const id = generateRandomHex()

            document.getElementById('addcardmodal').setAttribute('onclick',`create_new_sim()`)
            modalElement = document.getElementById('modal');
            const modal = new bootstrap.Modal(modalElement); 
            modal.show(); 
        };

        var path = window.location.pathname;
        var hex_code = path.split("/").pop();
        console.log( hex_code );

        function add_data_to_DOM(data, results_div){
                master_div = document.createElement('div')
                master_div.setAttribute("class", 'w-100 mt-3')

                title_link = document.createElement('a')
                title_link.setAttribute("class", "text-black text-decoration-none m-0")
                title_link.setAttribute('href', data[7])

                title_title = document.createElement('h4')
                title_title.setAttribute("class", "fw-bold d-flex flex-row justify-content-between")

                title_content = document.createElement('span')
                title_content.innerText = data[1]

                title_score = document.createElement('span')
                title_score.innerText = data[6]

                authors = document.createElement('p')
                authors.classList.add('m-0')
                authors.innerText = data[3]

                year_journal = document.createElement('p')
                year_journal.classList.add('m-0')

                year_journal.innerText = `${data[2]}, ${data[4]}`

                title_title.appendChild(title_content)
                title_title.appendChild(title_score)

                title_link.appendChild(title_title)

                master_div.appendChild(title_link)
                master_div.appendChild(authors)
                master_div.appendChild(year_journal)
                
                category = data[5]

                category_id = category.replace(/\s+/g, '');

                console.log(!document.getElementById(category_id))

                if (!document.getElementById(category_id)){
                    category_div = document.createElement('div')
                    category_div.setAttribute('id', category_id)
                    category_div.setAttribute('class', 'mb-4')

                    category_title = document.createElement('h2')
                    category_title.setAttribute('class', 'fw-bold text-decoration-underline')
                    category_title.innerText = data[5]
                    
                    category_div.appendChild(category_title)
                    
                    console.log(category_div)  

                    results_div.appendChild(category_div)
                    console.log(1)
                }else{
                    category_div = document.getElementById(category_id)
                    console.log(2)
                }
                

                category_div.appendChild(master_div)
            
        }

        function get_contents(hex_code){
            fetch(`/results/${hex_code}`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
            .then(response => response.json())
            .then(data => {
                console.log(data)
                
                results_div = document.querySelector("#response-box");
                Array.from(data).forEach(e => {
                    add_data_to_DOM(e, results_div);
                })
                
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        function scrape(hex_code){
            fetch(`/scrape/${hex_code}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
    </script>
</head>
<body>
    <nav class="w-100">
        <div class="container">
            <a href="/"><img src="https://genfare.atlassian.net/wiki/download/attachments/524289/atl.site.logo?version=2&modificationDate=1445562795035&cacheVersion=1&api=v2" alt="">
            </a>
        </div>
    </nav>
    <div class="container">

    
        
        
        <section>
            <h1 class="text-center fw-bold mt-0 mt-lg-3">Literature manager</h1>
    
    

                    <div id="response-box" class="w-100">
                        
                    </div>
        </section>

        

        
    </div>
    <script>
        res = get_contents(hex_code);
        console.log(res)

        

        const socket = io('localhost:4321', {auth: 'frontend'});

        socket.on('connect', () => {
            console.log('Connected to server with ID:', socket.id);
        });
        console.log(hex_code)

        socket.on(`scrape_${hex_code}`, (data) => {
            console.log(data)
            result_div = document.querySelector('#response-box')
            add_data_to_DOM(data['paper'], result_div)
        });

        
    </script>
</body>
</html>